# SPIFFE and SPIRE Architecture Documentation

## 1. Introduction to SPIFFE and SPIRE

### 1.1 Overview

The Security Problems Inference From Federated Elements (SPIFFE) specification provides a framework for standardized service identity in cloud-native environments. SPIFFE addresses the fundamental challenge of establishing trust between services in distributed systems by defining a universal identity standard that works across different platforms, cloud providers, and orchestration systems. The SPIFFE Runtime Environment (SPIRE) is the reference implementation of the SPIFFE specification, providing a production-ready identity management system that automatically issues and rotates short-lived credentials for workloads.

In the NEAM platform architecture, SPIFFE/SPIRE serves as the foundational identity layer for the Zero Trust security model. Traditional perimeter-based security assumed that services inside the network boundary were inherently trustworthy, but Zero Trust requires that every service prove its identity regardless of network location. SPIFFE provides the standardized identifiers (SPIFFE IDs) that uniquely identify each workload, while SPIRE provides the mechanism to attest the workload's environment and issue cryptographic credentials (SPIFFE Verifiable Identity Documents or SVIDs) that other services can verify. This identity-first approach enables granular authorization policies, mutual TLS authentication, and service-to-service authorization without relying on network location as a trust indicator.

The implementation within the NEAM platform follows a distributed architecture pattern where SPIRE agents run on each node, performing local workload attestation and credential issuance, while the SPIRE server maintains the trust anchor and orchestrates policy enforcement across the cluster. This design ensures high availability and low latency for credential operations while maintaining strong security guarantees through the separation of attestation and issuance responsibilities. The SPIRE server acts as the certificate authority for the platform, issuing X.509 certificates and JWT tokens that represent service identities, with automatic rotation occurring multiple times per day to limit the impact of credential compromise.

### 1.2 Document Purpose and Scope

This documentation provides comprehensive guidance on the SPIFFE architecture implemented within the NEAM platform, covering theoretical foundations, architectural patterns, deployment procedures, configuration options, operational management, and troubleshooting methodologies. The document serves multiple audiences including platform architects designing identity infrastructure, security engineers implementing Zero Trust controls, DevOps teams managing SPIRE deployments, and operations personnel responsible for day-to-day identity management.

The scope encompasses the complete SPIFFE/SPIRE implementation stack including the SPIRE server cluster configuration, SPIRE agent deployment across worker nodes, workload attestation mechanisms, SPIFFE ID assignment policies, SVID lifecycle management, and integration with platform components such as Istio service mesh for mTLS and application-level identity verification. The documentation also addresses security considerations, compliance requirements, and operational procedures necessary for maintaining a robust identity infrastructure in a production environment.

## 2. SPIFFE Technical Architecture

### 2.1 Core Components and Their Responsibilities

The SPIFFE architecture consists of three primary components that work together to provide workload identity: the SPIRE Server, SPIRE Agents, and the Workload API. Each component has distinct responsibilities and security boundaries that ensure the overall system's integrity. Understanding these components and their interactions is essential for effective deployment, configuration, and troubleshooting of the identity infrastructure.

The SPIRE Server functions as the trust anchor and certificate authority for the platform. It maintains the private keys used to sign all identity documents, stores the attestation policies that determine which workloads can receive identities, and coordinates credential rotation across the cluster. The server runs as a StatefulSet in Kubernetes, ensuring stable network identity and persistent storage for its database backend. In production deployments, the SPIRE server supports high availability configurations with multiple replicas, allowing the platform to continue issuing credentials even during maintenance windows or partial failures. The server exposes two primary gRPC interfaces: one for agents to fetch updates and attestation policies, and an administrative API for management operations such as registering new workload entries and configuring attestation selectors.

SPIRE Agents are deployed on every node in the cluster and serve as the bridge between the platform's infrastructure and individual workloads. Each agent is responsible for detecting workloads running on its node, performing attestation to verify the workload's identity claims, and issuing short-lived credentials through the Workload API. The agent runs as a DaemonSet, ensuring that every worker node has a local identity provider that can respond to workload requests without network latency to a central authority. Agents maintain a cache of attestation policies and identity configurations received from the server, allowing them to operate independently during brief network partitions while still respecting the most recent policies. The agent's security model relies on the node's operating system kernel to provide workload detection through mechanisms such as Unix domain sockets that only processes on the same node can access.

The Workload API is a Unix domain socket exposed by each SPIRE Agent that workloads use to obtain their identities. The socket is accessible only to processes running on the same node, providing a natural security boundary that prevents cross-node identity requests. When a workload contacts the Workload API, the agent performs attestation by examining the workload's process metadata, environment variables, and Kubernetes service account tokens to verify that the request comes from an authorized workload. Upon successful attestation, the agent issues a SVID containing the workload's SPIFFE ID and signs it with a key derived from the server's root key through a secure delegation process. The Workload API also provides JWT tokens for workloads that need to authenticate to services that don't support mTLS, extending the SPIFFE identity framework to legacy applications.

### 2.2 SPIFFE ID Structure and Naming Conventions

SPIFFE IDs provide globally unique identifiers for workloads, following a structured URI format that encodes information about the workload's type, location, and purpose. The SPIFFE ID format is `spiffe://<trust domain>/<path>`, where the trust domain identifies the administrative boundary of the organization, and the path uniquely identifies the workload within that boundary. The NEAM platform uses a trust domain of `neam.internal` for all workloads, ensuring that identities issued by the platform's SPIRE server are clearly distinguished from identities issued by other organizations or infrastructure components.

The path component of SPIFFE IDs follows hierarchical conventions that reflect the workload's role in the system. The NEAM platform uses the format `spiffe://neam.internal/<namespace>/<service-type>/<service-name>`, where namespace corresponds to the Kubernetes namespace containing the workload, service-type identifies the general category of the service (such as api, worker, or database), and service-name provides the specific workload identifier. For example, a payment processing API running in the finance namespace would have the SPIFFE ID `spiffe://neam.internal/finance/api/payment-processor`. This hierarchical structure enables flexible authorization policies that can match identities at any level of granularity, such as allowing all API services in the finance namespace to access certain resources.

The trust domain component plays a critical role in multi-cluster and federation scenarios. When services need to communicate across cluster boundaries or with external partners, the trust domain in the SPIFFE ID identifies which authority issued the credential, allowing receiving services to make authorization decisions based on the issuer's identity. The NEAM platform configures external services to recognize only SVIDs from the `neam.internal` trust domain, preventing identity spoofing from untrusted sources. For federation with external organizations, separate trust domains would be established with explicit cross-signing arrangements, and authorization policies would explicitly allow or deny access based on the originating trust domain.

SPIFFE ID assignment in the NEAM platform follows a registration-based model where administrators create entry records in the SPIRE server that map selectors (such as Kubernetes service accounts or container image digests) to specific SPIFFE IDs. This approach provides fine-grained control over identity assignment while ensuring that only authorized workloads can obtain particular identities. The registration entries include selectors that the SPIRE Agent uses during attestation, such as the `k8s:ns:<namespace>` and `k8s:sa:<serviceaccount>` selectors that identify workloads based on their Kubernetes metadata. When an agent detects a workload matching these selectors, it requests and receives the corresponding identity from the server, caching the credential locally for the workload to retrieve through the Workload API.

### 2.3 SVID Types and Cryptographic Specifications

SPIFFE Verifiable Identity Documents (SVIDs) are the cryptographic credentials that prove workload identity to other services. The NEAM platform supports two types of SVIDs: X.509 certificates for mutual TLS authentication and JWT tokens for API authentication. Each SVID type has specific use cases, cryptographic properties, and security characteristics that make it suitable for different authentication scenarios in the platform.

X.509 SVIDs are digital certificates that conform to the SPIFFE ID format in the Subject Alternative Name (SAN) extension. These certificates follow the X.509 v3 standard and include the SPIFFE ID as a URI-type SAN, allowing other services to extract the workload's identity from the certificate during the TLS handshake. The certificates use RSA or ECDSA keys with a minimum key length of 2048 bits for RSA and 256 bits for ECDSA, meeting current cryptographic standards for secure communication. X.509 SVIDs have a short validity period, typically 24 hours in the NEAM platform, after which they automatically expire and must be refreshed. This short lifetime limits the window of exposure if a credential is compromised, as the attacker can only use the credential until it expires.

The X.509 SVID certificate chain consists of three levels: the SPIRE server's root CA certificate at the top, intermediate certificates issued by the root CA for specific purposes in the middle, and the workload certificate at the bottom. The root CA private key never leaves the SPIRE server's secure storage, providing a strong protection mechanism against key compromise. Intermediate certificates have shorter lifespans and can be rotated without disrupting workload operations, while the frequent rotation of leaf certificates ensures that each workload's identity credentials are continuously refreshed. The NEAM platform configures the SPIRE server to use a hardware security module (HSM) for root CA key storage, providing additional protection against key extraction even if the server's filesystem is compromised.

JWT SVIDs are JSON Web Tokens that encode the workload's SPIFFE ID along with additional claims such as audience restriction and expiration time. Unlike X.509 SVIDs, JWT tokens don't require a TLS connection for verification; the receiving service can validate the token's signature using the SPIRE server's public key and check the claims locally. JWT SVIDs are particularly useful for authenticating requests to services that don't terminate TLS, such as legacy applications or external APIs that expect bearer tokens. The NEAM platform configures JWT SVIDs with a shorter validity period than X.509 certificates, typically 5 minutes, to minimize the impact of token theft.

The cryptographic algorithms used for SVID signing in the NEAM platform follow security best practices and compliance requirements. For X.509 certificates, the platform uses ECDSA with the P-256 curve for leaf certificates and RSA-4096 for intermediate and root CA certificates. For JWT signing, the platform uses ES256 (ECDSA with SHA-256) for token signatures. These algorithm choices provide strong security guarantees while maintaining reasonable performance for high-throughput services. The platform monitors cryptographic developments and maintains the ability to update algorithms as standards evolve, with automatic rotation ensuring that all credentials use approved algorithms even during algorithm transitions.

## 3. SPIRE Deployment Architecture

### 3.1 Server Cluster Configuration

The SPIRE server deployment in the NEAM platform follows a high-availability architecture designed to provide continuous identity services despite component failures or maintenance operations. The server runs as a Kubernetes StatefulSet with three replicas spread across different availability zones, ensuring that the identity infrastructure survives single-zone outages. Each replica maintains its own copy of the server's SQLite database through persistent volume claims, with the leader replica handling write operations while all replicas accept read operations for workload attestation requests.

The server's external interface consists of a Kubernetes Service that load balances traffic across all replicas, providing a stable endpoint for agents to connect to regardless of which replica is currently the leader. The service uses session affinity based on source IP to ensure that agents maintain connections to the same replica, reducing the complexity of leader election handling on the client side. For production deployments with strict availability requirements, the platform can be configured to use an external database such as PostgreSQL instead of SQLite, enabling true multi-master write capabilities and easier disaster recovery procedures.

Configuration of the SPIRE server is managed through a ConfigMap mounted as a volume, allowing configuration updates without rebuilding container images. The primary configuration file `server.conf` specifies the trust domain, database connection parameters, key storage settings, and plugin configurations for attestation and registration. The NEAM platform configures the server to use the Kubernetes attestation plugin, which verifies workload identities by checking the node and service account claims in the workload's service account token. Additionally, the server is configured with the Node Attestor plugin that verifies the identity of the nodes that SPIRE agents run on, establishing a hardware root of trust from the node's kubelet credentials.

The server's plugin architecture enables customization of the attestation and identity issuance process. The NEAM platform uses the UpstreamAuthority plugin to integrate with the platform's HSM infrastructure for root key storage, ensuring that the server's signing keys never exist in plaintext form. The registration plugin stores entry records in the server's database, mapping workload selectors to SPIFFE IDs. For federated identity with external organizations, the federation plugin enables the server to fetch and validate identity bundles from remote trust domains, allowing workloads to authenticate to services in partner organizations.

### 3.2 Agent Deployment and Node Attestation

SPIRE agents deploy as a DaemonSet across all worker nodes in the cluster, ensuring that every node has local access to identity services for workloads running on that node. The agent container runs with elevated privileges required to create the Workload API socket and access node-level information during workload attestation. The agent's deployment configuration includes resource limits and requests that ensure predictable resource consumption even on heavily loaded nodes.

Node attestation establishes the identity of the node before the agent can issue credentials to workloads. The NEAM platform configures agents to use the Kubernetes node attestor, which obtains identity tokens from the kubelet and presents them to the SPIRE server for verification. The server validates the token against the Kubernetes API, confirming that the node is a legitimate member of the cluster. Upon successful node attestation, the server issues a node SVID that the agent uses to authenticate its communications with the server. This node SVID has a longer validity period than workload SVIDs, typically 72 hours, reflecting the relative stability of node identities compared to short-lived workloads.

The agent's configuration file specifies the server's gRPC endpoint, the workload attestation plugins to use, and the paths for local caching of identity documents. The NEAM platform configures agents to use the k8s workload attestor, which detects containers through the container runtime socket and extracts metadata such as pod name, namespace, and service account from the container's environment or filesystem. The agent periodically polls the container runtime to detect new workloads and automatically issues credentials when it detects a workload matching a registered entry. This automatic detection eliminates the need for manual configuration changes when deploying new services, as long as the service uses a registered service account.

Agent health monitoring in the NEAM platform uses Kubernetes readiness and liveness probes that check the agent's ability to communicate with the server and respond to workload requests. The readiness probe verifies that the agent has successfully attested with the server and has valid node credentials, while the liveness probe ensures the agent process is responsive. Failed liveness probes trigger container restart, allowing the agent to recover from transient issues. The platform also collects agent metrics including the number of attested workloads, SVID issuance latency, and cache hit rates, enabling operations teams to identify capacity issues or attestation problems before they impact service availability.

### 3.3 Workload Attestation Mechanisms

Workload attestation is the process by which SPIRE agents verify the identity of workloads requesting credentials through the Workload API. The attestation process combines evidence from multiple sources to build confidence in the workload's identity, making it difficult for unauthorized processes to obtain credentials for workloads they don't actually run. The NEAM platform implements a multi-layered attestation strategy that combines platform-level selectors with application-level identifiers.

The primary attestation mechanism in the NEAM platform uses Kubernetes service account tokens as the initial proof of workload identity. When a workload mounts its service account token as a volume, the agent can read the token and extract claims about the workload's identity including the namespace, service account name, and pod name. The agent presents these claims to the SPIRE server along with evidence about the process's PID and filesystem metadata, allowing the server to verify that the process claiming to be a particular service account is actually running as that identity. This mechanism provides strong protection against simple identity spoofing, as the attacker would need to compromise the kubelet or container runtime to forge service account tokens.

For workloads that don't use service accounts or require additional identity evidence, the NEAM platform supports custom attestation selectors that match based on container image digest, environment variables, or process metadata. Image digest selectors provide protection against container image tampering by requiring workloads to run from specific, immutable image references rather than tags that could be overwritten. Environment variable selectors allow administrators to configure additional identity claims that workloads must present, useful for distinguishing between deployment environments (such as production versus staging) or workload roles (such as primary versus replica). Process metadata selectors verify properties of the running process such as user ID, group ID, or executable path, providing defense in depth against credential theft.

The attestation process also includes runtime detection to prevent process injection attacks. The agent monitors the process table and filesystem to detect processes that might be attempting to impersonate legitimate workloads. If the agent detects multiple processes claiming the same identity or processes with suspicious properties (such as unusual parent-child relationships or modified executable paths), it can deny credential issuance and alert security personnel. This runtime monitoring provides protection against attacks that bypass traditional attestation by exploiting vulnerabilities in the container runtime or workload configuration.

## 4. Registration Entry Management

### 4.1 Entry Configuration and Selector Types

Registration entries define the mapping between workload properties (selectors) and SPIFFE IDs, providing the policy framework that governs identity assignment in the platform. Each entry specifies one or more selectors that must all match for the entry to apply, along with the SPIFFE ID to assign and optional constraints on the credential's properties. The NEAM platform's registration entries are stored in the SPIRE server's database and distributed to agents through the agent-cache.conf configuration, ensuring consistent identity assignment across the cluster.

Kubernetes selectors form the foundation of workload identity in the NEAM platform. The `k8s:ns:<namespace>` selector matches workloads running in a specific namespace, providing namespace-level identity grouping for authorization policies. The `k8s:sa:<serviceaccount>` selector matches workloads using a specific service account, enabling identity assignment based on the workload's configured permissions rather than its deployment details. The `k8s:pod-label:<key>=<value>` selector matches workloads based on Kubernetes labels, supporting complex identity patterns that span multiple deployments or services. These selectors can be combined to create precise matching rules; for example, an entry requiring both `k8s:ns:payments` and `k8s:sa:payment-processor` would match only the designated service account in the payments namespace.

Container image selectors provide identity assignment based on the workload's container image rather than its deployment configuration. The `docker:image-id:<digest>` selector matches workloads running from a specific image digest, ensuring that only workloads running authorized versions of the image can obtain particular identities. This selector is particularly important for security-critical services where image integrity is paramount, as it prevents attackers from deploying modified versions of the container image even if they can create pods in the cluster. The image digest is obtained from the container registry and remains constant across deployments, unlike image tags that can be overwritten.

The NEAM platform also supports federated identity entries that allow workloads to obtain identities from external trust domains. These entries are configured with the `federated:<trust_domain>` selector and the foreign SPIFFE ID to assign, enabling the platform to trust and issue credentials on behalf of partner organizations. Federated entries require careful management and approval workflows, as they allow identities from external domains to access platform resources. The platform maintains an approval process for federated entries that includes security review and documentation of the business justification for the federation relationship.

### 4.2 Entry Lifecycle and Management Procedures

Registration entries have a defined lifecycle that includes creation, modification, review, and deletion phases. Understanding this lifecycle and implementing appropriate controls is essential for maintaining the integrity of the identity system over time. The NEAM platform implements entry management through a combination of manual configuration using the `spire-server entry create` command and automated synchronization with Kubernetes resources.

Entry creation in the NEAM platform follows a formal approval process that ensures all identity assignments are authorized and documented. When a new service requires SPIFFE identity, the development team submits a request that includes the desired SPIFFE ID pattern, the workload selectors to use, and the business justification for the identity assignment. Security reviewers evaluate the request for alignment with the principle of least privilege, ensuring that the requested identity doesn't grant unnecessary permissions. Upon approval, the entry is created with the appropriate selectors and registered in the SPIRE server's database. The entry creation is logged in the platform's audit system, providing an immutable record of all identity assignments.

Entry modification is restricted to authorized personnel and follows the same approval process as new entries when the modification would expand the workload's identity scope or privileges. Modifications to selectors or SPIFFE IDs must be carefully evaluated, as they can cause service disruptions if the workload no longer matches any entry. The NEAM platform implements entry versioning in the SPIRE server, allowing administrators to review the history of modifications and roll back problematic changes. Before modifying an entry, administrators verify that no active workloads are currently using the identity, preventing disruption to running services.

Entry deletion requires careful coordination to avoid impacting running workloads. When an entry is deleted, workloads matching that entry lose their identity credentials at the next SVID rotation, typically within 24 hours. The NEAM platform implements a grace period for entry deletion, during which the entry remains active but is marked for future deletion. During this period, administrators can verify that all workloads using the identity have been migrated to new entries or decommissioned. The deletion process sends notifications to workload owners, alerting them to the pending identity loss and allowing them to take corrective action. Only after the grace period expires and all affected workloads are verified to be migrated does the system permanently remove the entry.

### 4.3 Automated Entry Synchronization

The NEAM platform implements automated entry synchronization through custom Kubernetes controllers that generate registration entries based on native Kubernetes resources. This automation reduces the operational burden of maintaining registration entries while ensuring that entries remain synchronized with the actual workload deployment state. The synchronization controller monitors Kubernetes Deployments, StatefulSets, and Services, creating and updating registration entries based on the workload's configuration.

The controller generates entries using a predictable naming convention that maps Kubernetes resources to SPIFFE IDs. For a Deployment named `payment-processor` in the `finance` namespace, the controller creates an entry with the SPIFFE ID `spiffe://neam.internal/finance/api/payment-processor` and selectors matching the deployment's namespace and the service account configured in the pod template. This predictable mapping enables both administrators and automated tools to understand the relationship between Kubernetes resources and SPIFFE identities without maintaining separate documentation.

Synchronization supports custom configuration through Kubernetes annotations on the workload resources. Administrators can override the default SPIFFE ID generation by adding the `spiffe.neam.io/spiffe-id` annotation with the desired identity. They can also add additional selectors or restrict the automatically generated selectors using the `spiffe.neam.io/selectors` annotation. These annotations provide flexibility for complex workloads that require custom identity configurations while maintaining the benefits of automated synchronization for standard workloads.

The synchronization controller detects and handles conflicts between automatically generated entries and manually managed entries. When a manual entry exists for the same selectors as an automatic entry, the controller preserves the manual entry and generates a warning in the logs, alerting administrators to the potential conflict. This behavior prevents automated processes from overwriting carefully crafted manual configurations while still providing the benefits of automation for the majority of workloads that don't require custom identity treatment.

## 5. Integration with Platform Components

### 5.1 Istio Service Mesh Integration

The NEAM platform integrates SPIFFE identity with Istio service mesh to provide automatic mutual TLS authentication between all services. This integration leverages the SPIRE infrastructure as the certificate authority for Istio's mTLS implementation, ensuring that the same identity system governs both application-level authentication and service mesh security. The integration combines SPIFFE's standardized identity model with Istio's traffic management and security features, creating a comprehensive Zero Trust networking solution.

Istio configures its Citadel component to use SPIRE as an external certificate authority instead of its built-in CA. When Citadel needs to issue a certificate for a workload, it requests the certificate from the SPIRE server, which performs attestation using the workload's Kubernetes service account and returns an X.509 SVID. Citadel caches these certificates and serves them to Envoy proxies during the TLS handshake, ensuring that all service mesh traffic uses cryptographically verified identities. This external CA integration maintains Istio's zero-configuration security model while providing the additional security guarantees of SPIFFE's attestation process.

The SPIFFE ID is conveyed to Istio's authorization policies through the `source.principal` attribute, enabling fine-grained access control based on workload identity rather than IP addresses or network ports. Authorization policies can permit or deny traffic based on exact SPIFFE ID match, namespace prefix, or service type patterns, providing flexibility in designing security policies that match the platform's organizational structure. For example, a policy might allow read access to sensitive data only from workloads with SPIFFE IDs matching the pattern `spiffe://neam.internal/finance/*/auditor`, ensuring that only designated audit services can access financial records.

The integration also enables Istio to use SPIFFE-based identity for egress traffic to external services. When services need to authenticate to external APIs or databases, Istio can present the workload's SPIFFE ID as part of the client certificate, allowing the external service to verify the caller's identity. This capability extends the Zero Trust model beyond cluster boundaries, providing identity-based authentication for hybrid architectures that span multiple clusters or cloud providers. External services must be configured to trust the NEAM platform's SPIFFE trust domain and validate the SPIFFE ID in the certificate's SAN extension.

### 5.2 Application-Level Identity Verification

Beyond service mesh integration, the NEAM platform provides libraries and frameworks for applications to directly verify and use SPIFFE identity for authorization decisions. This application-level identity enables fine-grained access control that considers workload identity even for traffic that doesn't pass through the service mesh, such as batch jobs, administrative tools, or legacy applications. The platform provides client libraries for multiple programming languages that abstract the complexity of contacting the Workload API and parsing SVID data.

The SPIFFE client library for Go applications provides functions to fetch the current workload's X.509 certificate and JWT token, extract the SPIFFE ID, and establish authenticated connections to other SPIFFE-enabled services. The library handles all aspects of credential lifecycle including automatic refresh before expiration, fallback to cached credentials during network disruptions, and proper handling of credential rotation. Applications use the library's configuration function to specify the expected SPIFFE IDs of services they will communicate with, enabling automatic TLS certificate verification that confirms the remote service's identity.

For authorization decisions, the platform provides a policy evaluation library that implements attribute-based access control using SPIFFE IDs as the primary subject attribute. Policies are expressed in a declarative format that specifies which SPIFFE IDs (or patterns of SPIFFE IDs) are permitted to perform which actions on which resources. The library evaluates incoming requests by extracting the caller's SPIFFE ID from their credential and checking it against the applicable policies. This evaluation can be performed at the application level for defense in depth, even when the service mesh already enforces similar policies.

The platform also provides tools for manual identity verification and debugging. The `spire-invoke` command-line tool allows operators to query the Workload API on a specific node and retrieve credentials for testing purposes. This tool is useful for verifying that workloads are receiving the expected identities and for troubleshooting attestation issues. The tool requires access to the node's SPIRE Agent socket, which is typically available through Kubernetes exec commands or through SSH access to node hosts for offline debugging scenarios.

## 6. Security Considerations and Best Practices

### 6.1 Threat Model and Mitigation Strategies

The SPIFFE architecture provides strong identity guarantees, but effective security requires understanding the threats the system is designed to address and implementing appropriate mitigations. The primary threats to SPIFFE-based identity systems include credential theft, attestation bypass, server compromise, and trust domain confusion. Each threat requires specific controls to ensure that the overall system maintains its security properties even when individual components are compromised.

Credential theft attacks attempt to steal SVIDs from running workloads or intercepted network traffic. The NEAM platform mitigates this threat through short credential lifetimes, automatically rotating X.509 certificates every 24 hours and JWT tokens every 5 minutes. This rapid rotation limits the window during which stolen credentials remain valid, reducing the impact of theft. Additionally, the platform stores credentials in memory only, never writing them to persistent storage, and configures workloads to use Unix file permissions to protect any cached credentials from access by other processes on the same node.

Attestation bypass attacks attempt to obtain credentials for workloads the attacker doesn't actually control. The NEAM platform mitigates this through multi-factor attestation that requires evidence from multiple independent sources. Workloads must present valid Kubernetes service account tokens, run in registered namespaces with registered service accounts, and pass runtime checks for process legitimacy. The platform also implements rate limiting on credential issuance, preventing attackers from rapidly requesting credentials for many different identities in an attempt to find valid combinations.

Server compromise represents the most severe threat, as an attacker with access to the SPIRE server could issue credentials for any identity in the trust domain. The NEAM platform mitigates this threat through hardware security module integration for root key protection, ensuring that signing keys never exist in plaintext form even if the server is compromised. The platform also implements separation of duties for server administration, requiring multiple authorized personnel to approve changes to attestation policies. Server access is logged comprehensively and monitored for anomalous patterns that might indicate compromise.

### 6.2 Operational Security Procedures

Effective operation of the SPIRE infrastructure requires adherence to security procedures that maintain the integrity of the identity system over time. These procedures cover key rotation, backup and recovery, access control, and monitoring, providing the operational framework necessary for production deployments. Following these procedures ensures that the platform's identity infrastructure remains secure and available even during routine operations or unexpected incidents.

Key rotation procedures ensure that signing keys are replaced periodically to limit the impact of potential compromise and to comply with cryptographic key lifetime recommendations. The NEAM platform implements automatic intermediate CA rotation every 90 days, with the SPIRE server managing the creation and distribution of new keys without operator intervention. Root CA key rotation is a manual process that requires careful planning and coordination, as it involves creating a new root key, cross-signing certificates issued under the old key, and eventually transitioning all workloads to the new root. The platform maintains a key rotation schedule and alerts operators when rotation is approaching.

Backup and recovery procedures ensure that the SPIRE server can be restored after infrastructure failures or disasters. The platform performs continuous database backups to a secure, isolated storage location, enabling point-in-time recovery of registration entries and server configuration. Backup integrity is verified periodically through restoration tests that exercise the recovery procedures in an isolated environment. The platform also maintains documented recovery procedures that specify how to restore service from backups, including verification steps to confirm that the restored server is functioning correctly before being returned to production.

Access control procedures govern who can view, modify, or administer the SPIRE infrastructure. The NEAM platform implements role-based access control through Kubernetes RBAC, granting different permissions to different operator roles based on their responsibilities. Platform operators can view registration entries and server status but cannot modify identity assignments without additional approval. Identity administrators can create and modify registration entries but cannot access server configuration or signing keys. Security administrators can access all functions including server configuration and audit logs, but their actions are subject to additional logging and periodic review. Access reviews are conducted quarterly, removing permissions from personnel who no longer require them.

### 6.3 Monitoring and Alerting

Comprehensive monitoring enables early detection of security incidents and operational issues in the SPIRE infrastructure. The NEAM platform collects metrics from both the SPIRE server and agents, visualizing them through Grafana dashboards and alerting on anomalous patterns that require investigation. Monitoring covers four primary areas: system health, attestation activity, credential lifecycle, and security events.

System health monitoring tracks the availability and performance of SPIRE components. The platform monitors SPIRE server replicas, alerting when replica count falls below the configured minimum or when servers become unresponsive. Agent health is monitored through the number of active agents compared to the expected node count, alerting when agents fail or are removed from the cluster. API latency metrics track the time required for credential issuance, alerting when latency exceeds thresholds that might indicate performance issues or potential denial of service attacks.

Attestation activity monitoring tracks patterns in workload attestation that might indicate security issues. The platform alerts when attestation failures exceed baseline rates, which could indicate misconfiguration or attack attempts. Unusual patterns in the number of attested workloads per node might indicate container escapes or process injection attacks. New SPIFFE IDs that haven't been seen before trigger informational alerts, enabling security teams to verify that new identity assignments are expected and authorized.

Credential lifecycle monitoring tracks the rotation and expiration of SVIDs across the platform. The platform alerts when credentials approach expiration without successful rotation, which could indicate agent communication issues or capacity constraints. Certificate chain validation failures are logged and alerted, as they might indicate configuration errors or attempts to inject fraudulent certificates. The platform also tracks the distribution of credential types (X.509 versus JWT) and their usage patterns, ensuring that the identity system is being used as designed.

## 7. Troubleshooting and Diagnostics

### 7.2 Common Issues and Resolution Procedures

Operating a SPIFFE infrastructure requires familiarity with common issues that can arise and the procedures to resolve them. The most frequent issues involve attestation failures, credential synchronization problems, and performance degradation. Understanding these issues and their root causes enables rapid resolution and minimizes the impact on platform services.

Attestation failures occur when workloads cannot obtain identities due to problems with the attestation process. The most common cause is selector mismatch, where the workload's actual properties don't match the selectors configured in the registration entry. Resolution involves verifying that the workload is running in the correct namespace, with the correct service account, and with the correct labels or image digests. The `spire-agent show workload` command displays the selectors detected for a specific workload, enabling comparison with the registration entry's expected selectors. If selectors are missing or incorrect, the workload may need to be redeployed with correct configuration, or the registration entry may need to be updated to match actual workload properties.

Credential synchronization problems manifest as services unable to communicate due to certificate validation failures or mismatched identities. These issues often occur when registration entries are modified but agents haven't received the update, or when cached credentials are out of sync between different components. Resolution begins with verifying that all agents have received the updated configuration by checking the agent's log for recent cache updates. If agents are out of date, forcing a cache refresh through the agent's API endpoint typically resolves the issue. For persistent problems, restarting the agent clears stale state and forces a full synchronization with the server.

Performance degradation in SPIRE infrastructure can impact the entire platform's ability to establish secure connections. Common causes include server resource exhaustion, database performance issues, or network connectivity problems between agents and servers. Resolution involves scaling server resources, optimizing database queries, or addressing network issues depending on the identified root cause. The platform maintains performance baselines that enable rapid identification of deviations from normal operation, allowing operators to address emerging performance issues before they impact service availability.

### 7.2 Diagnostic Tools and Commands

The SPIRE distribution includes diagnostic tools that enable operators to investigate and troubleshoot identity issues. These tools expose internal state and metrics that aren't available through standard monitoring, providing the detailed information necessary for root cause analysis. The NEAM platform documents and standardizes the use of these tools to ensure consistent troubleshooting approaches across the operations team.

The `spire-server` CLI provides administrative functions for managing the SPIRE server. The `spire-server entry show` command displays registration entries, enabling verification that entries exist and are configured correctly. The `spire-server entry count` command provides the total number of registered entries, useful for detecting unexpected changes. The `spire-server agent list` command displays all attested agents, showing which nodes are currently active and when they last communicated with the server. The `spire-server fetch bundle` command retrieves the current trust bundle, enabling verification that all components are using consistent trust anchors.

The `spire-agent` CLI provides diagnostic functions for SPIRE agents. The `spire-agent healthcheck` command verifies that the agent is operational and can communicate with the server, providing a quick health check for agent nodes. The `spire-agent fetch x509` command retrieves the current workload certificate, useful for verifying that the workload has obtained the expected identity. The `spire-agent show workload` command displays detailed information about workloads detected on the node, including their selectors and registration status. This command is particularly useful for diagnosing attestation issues, as it shows exactly what the agent observes about the workload.

Log analysis provides detailed insight into SPIRE operations. Server logs attestation requests, entry look captureups, and credential issuance events. Agent logs capture workload detection, attestation attempts, and communication with the server. The NEAM platform centralizes these logs in a searchable repository, enabling correlation of events across components and efficient root cause analysis. Log verbosity can be increased temporarily for debugging sessions, providing additional detail for complex issues while maintaining normal logging levels during routine operation.

## 8. Compliance and Audit Requirements

### 8.1 Regulatory Compliance Considerations

The SPIFFE implementation in the NEAM platform supports compliance with various regulatory requirements that mandate strong identity controls, audit logging, and access management. While specific compliance frameworks have unique requirements, the standardized identity model provided by SPIFFE addresses common themes across regulations including NIST 800-63, PCI DSS, and SOC 2. Understanding how SPIFFE capabilities map to compliance requirements enables effective compliance documentation and audit preparation.

Identity proofing and lifecycle management requirements are addressed through SPIFFE's registration entry management procedures. The platform's entry approval workflow ensures that all identity assignments are authorized and documented, satisfying requirements for identity proofing before credential issuance. The automated credential rotation and expiration mechanisms ensure that identities don't persist indefinitely, addressing requirements for periodic identity revalidation. The platform maintains records of all identity assignments, modifications, and revocations, providing the audit trail necessary for compliance verification.

Cryptographic standards requirements are addressed through SPIFFE's configuration of certificate algorithms and key lengths. The platform uses approved cryptographic algorithms (ECDSA P-256 or RSA 2048+) for workload credentials, meeting requirements for strong cryptographic protection. Root CA keys are protected through HSM integration, satisfying requirements for hardware protection of cryptographic keys. The platform maintains documented procedures for key rotation and can demonstrate compliance with cryptographic algorithm transitions.

Audit logging requirements are addressed through comprehensive logging of SPIRE operations. All registration entry modifications are logged with the operator identity, timestamp, and change details. All credential issuance events are logged with the requester identity and the issued credential's SPIFFE ID. All administrative operations are captured in immutable audit logs that cannot be modified or deleted by platform operators. The platform exports these logs to a secure, isolated repository for long-term retention and tamper-evident storage.

### 8.2 Audit Log Integration

The NEAM platform integrates SPIRE audit logs with the central audit system to provide comprehensive visibility into identity operations across the platform. This integration ensures that identity-related events are captured alongside other security events, enabling correlation analysis and comprehensive security monitoring. The audit system receives SPIRE events through a secure channel that preserves log integrity and provides real-time alerting on suspicious activity.

SPIRE audit events are categorized by type and severity to enable efficient review and prioritization. Authentication events (agent attestation, workload attestation) are classified as informational and reviewed periodically. Authorization events (entry creation, modification, deletion) are classified as medium severity and reviewed daily. Administrative events (server configuration changes, key operations) are classified as high severity and trigger immediate alerting. This classification enables efficient use of security analyst time while ensuring that important events receive appropriate attention.

The audit system maintains the integrity of SPIRE logs through cryptographic protections that detect tampering. Log entries are hashed and chained together, making it impossible to modify or delete historical entries without detection. The log repository is isolated from the SPIRE infrastructure, preventing attackers who compromise the identity system from also covering their tracks in the audit logs. Retention policies ensure that audit logs are maintained for the required duration based on applicable compliance frameworks, with secure archival procedures for long-term storage.

Audit reporting provides visibility into identity system operations for compliance verification and security review. The platform generates daily reports summarizing identity activity including new registrations, modifications, and credential statistics. Weekly reports provide trend analysis that identifies unusual patterns requiring investigation. Compliance reports map SPIRE controls to specific regulatory requirements, documenting how the platform satisfies each applicable requirement. These reports are generated automatically and archived for audit evidence, reducing the manual effort required for compliance verification.
