# Default values for neam-library
# These values are inherited by all consuming service charts

global:
  # Environment: dev, staging, prod
  environment: dev
  # Domain suffix for external services
  domainSuffix: ""
  # Image pull secrets (if needed)
  imagePullSecrets: []
  # - name: registry-credentials

  # Common labels applied to all resources
  labels:
    app.kubernetes.io/managed-by: Helm
    neam.io/version: "0.1.0"

# Image configuration
image:
  repository: ""
  tag: ""
  pullPolicy: IfNotPresent

# Service account configuration
serviceAccount:
  create: true
  name: ""
  annotations: {}
  automountToken: true

# Deployment configuration
deployment:
  # Number of replicas
  replicas: 1
  # Update strategy
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  # Pod annotations
  annotations: {}
  # Pod labels
  labels: {}
  # Security context at pod level
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  # Container security context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  # Termination grace period
  terminationGracePeriodSeconds: 30
  # Topology spread constraints
  topologySpreadConstraints: []
  # - maxSkew: 1
  #   topologyKey: topology.kubernetes.io/zone
  #   whenUnsatisfiable: ScheduleAnyway
  #   labelSelector:
  #     matchLabels:
  #       app.kubernetes.io/name: {{ include "neam.library.name" . }}

# Container configuration
container:
  # Port configuration
  ports:
    - name: http
      containerPort: 8080
      protocol: TCP
  # Environment variables
  env: []
  # Environment from ConfigMap/Secret
  envFrom: []
  # Resources (requests/limits)
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  # Liveness probe
  livenessProbe:
    enabled: true
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
  # Readiness probe
  readinessProbe:
    enabled: true
    httpGet:
      path: /ready
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
    successThreshold: 1
  # Startup probe (for slow starting apps)
  startupProbe:
    enabled: false
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30
    successThreshold: 1
  # Lifecycle hooks
  lifecycle:
    preStop:
      exec:
        command: ["sh", "-c", "sleep 5"]
    postStart: {}
  # Volume mounts
  volumeMounts: []
  # Additional volumes
  volumes: []

# Service configuration
service:
  enabled: true
  type: ClusterIP
  annotations: {}
  labels: {}
  ports:
    - name: http
      port: 80
      targetPort: http
      protocol: TCP
  # Session affinity
  sessionAffinity: None
  # External traffic policy
  externalTrafficPolicy: ""

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  labels: {}
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  tls: []
  # - secretName: tls-secret
  #   hosts:
  #     - example.com

# ConfigMap configuration
configMap:
  enabled: true
  name: ""
  data: {}
  binaryData: {}
  # Files to mount (key: filename, value: content)
  files: {}

# Secret configuration
secret:
  enabled: true
  name: ""
  data: {}
  stringData: {}
  type: Opaque

# Horizontal Pod Autoscaler
hpa:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: ""
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
  metrics: []

# Pod Disruption Budget
pdb:
  enabled: false
  minAvailable: ""
  maxUnavailable: 1
  # For at-least-n disruption
  # minAvailable: 2

# Network Policy
networkPolicy:
  enabled: false
  # Default deny all ingress/egress
  defaultDeny: false
  # Allow ingress from namespace
  ingressNamespaces: []
  # Allow egress to namespace
  egressNamespaces: []
  # Allow egress to DNS
  egressDNS: true
  # Allow egress to specific CIDRs
  egressCIDRs: []
  # Labels for namespace selector
  namespaceSelector: {}

# PodMonitor (for Prometheus Operator)
podMonitor:
  enabled: false
  annotations: {}
  labels: {}
  path: /metrics
  port: http
  interval: 30s
  scrapeTimeout: 10s

# ServiceMonitor (for Prometheus Operator)
serviceMonitor:
  enabled: false
  annotations: {}
  labels: {}
  path: /metrics
  port: http
  interval: 30s
  scrapeTimeout: 10s

# PriorityClass
priorityClassName: ""

# Environment-specific overrides
environments:
  dev:
    replicas: 1
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 256Mi
    hpa:
      enabled: false
    pdb:
      enabled: false

  staging:
    replicas: 2
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    hpa:
      enabled: true
      minReplicas: 2
      maxReplicas: 5
    pdb:
      enabled: true
      minAvailable: 1

  prod:
    replicas: 3
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
    hpa:
      enabled: true
      minReplicas: 3
      maxReplicas: 20
    pdb:
      enabled: true
      minAvailable: 2
    networkPolicy:
      enabled: true
      defaultDeny: true
