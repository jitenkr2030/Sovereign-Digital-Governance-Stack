global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: ${ENVIRONMENT:-development}
    service: csic-reporting

alerting:
  alertmanagers:
    - static_configs:
        - targets: []
      timeout: 10s
      api_version: v2

rule_files:
  - /etc/prometheus/rules/*.yml

scrape_configs:
  # Self monitoring
  - job_name: prometheus
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: /metrics

  # Regulatory Reporting API Service
  - job_name: csic-reporting-api
    metrics_path: /metrics
    static_configs:
      - targets: ['reporting-api:9091']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+):\\d+'
        replacement: '${1}'
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod
        replacement: '${1}'

  # PostgreSQL Database
  - job_name: csic-reporting-postgres
    static_configs:
      - targets: ['reporting-db:9187']
    metrics_path: /metrics

  # Redis
  - job_name: csic-reporting-redis
    static_configs:
      - targets: ['reporting-redis:9121']
    metrics_path: /metrics

  # Kafka
  - job_name: csic-reporting-kafka
    static_configs:
      - targets: ['kafka:9308']
    metrics_path: /metrics

  # MinIO
  - job_name: csic-reporting-minio
    static_configs:
      - targets: ['minio:9000']
    metrics_path: /minio/v2/metrics/cluster
